---
date: 2017-01-16
title: Procedimento Client
categories:
  - Client
description:  Procedimentos STCP OFTP CLIENT 
type: Document
---

# Procedimentos STCP OFTP CLIENT 

## **Habilitando o Debug no STCP OFTP Client**

Em alguns casos, para se obter uma análise mais detalhada de problemas relacionados ao intercâmbio de arquivos, torna-se necessária a depuração dos processos de conexão e transferência, realizadas pelo STCP OFTP Client.

Através da configuração do parâmetro “Nível de debug” é possível gerar um arquivo de depuração na pasta **DEBUG** (Ex. C:\STCPCLT\Debug) do diretório de instalação do STCP.

Acesse o STCP OFTP Client Config (Iniciar – Todos os programas – Riversoft STCP OFTP Client). Selecione o perfil desejado na guia Perfis e clique no botão Propriedades. Na janela Propriedades do perfil, na guia Odette, altere o valor do campo "Nível de debug" para 63 (outros valores podem ser utilizados – vide Tabela 2). Após a alteração, disponibilize um arquivo de teste na pasta SAIDA do perfil, que apresenta o erro, e inicie uma nova conexão. O arquivo de debug será gerado no diretório **DEBUG** (Ex. C:\STCPCLT\Debug).

> NOTA: Uma vez gerado o erro, você pode voltar o nível de debug para o seu valor padrão (0).

![](/images/imagem2/img71.png)

Para cada tentativa de conexão será criado um novo arquivo de depuração no diretório DEBUG com a seguinte sintaxe:  
ODTDEB.< Protocolo>.< Perfil>.YYYYMMDDhhmmssnnn.

Protocolo | TCPIP, X25, SERIAL ou PAD
:---      | :---
Perfil    | Nome do perfil utilizado
YYYY      | Ano
MM        | Mês
DD        | Dia
hh        | Hora
mm        | Minuto
ss        | Segundos
nnn       | Milésimos de segundos
Tabela 1 | 


A tabela a seguir contém a relação entre o nível de detalhamento e as informações que serão geradas.

Nível | Descrição
:---  | :---
0     | Não grava o arquivo de depuração.
1     | Grava as informações de entrada e saída das sub-rotinas.
2     | Grava as informações de mudanças do estado do protocolo.
4     | Grava as informações dos pacotes recebidos e enviados, formatado por campo.
8     | Grava as informações dos pacotes recebidos e enviados, formatado em hexadecimal.
16    | Grava as informações dos eventos ocorridos (Somente se ocorrer algum erro).
32    | Grava as informações dos sub-registros.
63    | Grava as informações completas (Debug completo).
Tabela 2 |


Em caso de dúvidas ou mais informações sobre este procedimento, entre em contato com a equipe de suporte da Riversoft Integração e Inovação atarvés de nossos contatos.

**RIVERSOFT INTEGRAÇÃO E DESENVOLVIMENTO DE SOFTWARE LTDA**   
Rua Marechal Deodoro, 480, 1º andar – Santa Lúcia – Pouso Alegre – MG – CEP 37553-405  
Telefone: 35 3421-2221  
E-mail: suporte@riversoft.com.br  
Web: (http://www.riversoft.com.br)  

------
## **Como configurar o Riversoft STCP OFTP Client para utilizar um servidor proxy para conexão**

1. Acesse o Riversoft STCP OFTP Client Config (Iniciar > Todos os programas > Riversoft STCP OFTP
Client).
2. Selecione o perfil desejado na guia **Perfis** e clique em **Propriedades**.

![](/images/imagem2/img7.png) 

3. Na guia **Geral**, clique no botão **Configurar**. 

![](/images/imagem2/img73.png) 

4. Na guia _**Proxy**_, clique no botão **Lê Configuração Proxy do IE** para obter as informações do navegador
Internet Explorer. Caso o servidor Proxy utilize autenticação, preencha-as.

![](/images/imagem2/img74.png) 

Autenticação _**Basic**_ é comumente utilizada com servidores Squid, Wingate e outros.

Autenticação _**NTLM**_ é comumente utilizada com servidores ISA, MS-Proxy.

**Notas:**

1. Algumas configurações de autenticação requerem a informação do servidor de domínio (quando aplicável) no seguinte padrão: <Nome do domínio>\<Usuário do domínio>.
2. Nos casos em que houver alteração da senha do usuário do domínio, a senha do STCP OFTP Client também deverá ser alterada.

Para maiores informações, por favor, consulte a documentação do produto disponível no link abaixo:   
(http://www.riversoft.com.br/downloads/manuais/STCPCli_4_0-PTB.pdf)

--------
## **Configuração do STCP OFTP Client para comunicação SSL3**

Para acessar o configurador do STCP OFTP Client, clique em Iniciar e depois clique em Riversoft STCP OFTP Client Config.

Selecione o Perfil desejado e clique no botão **Propriedades**.

![](/images/imagem2/img75.png) 

Na guia **Geral** pressione o botão **Configurar**.

![](/images/imagem2/img76.png) 

Na guia **TCP-IP** marque a opção **Comunicação Segura** e em seguida selecione SSL3 e clique em **OK** concluir o processo de configuração.

![](/images/imagem2/img77.png) 

Caso a comunicação entre o STCP OFTP server Enterprise/Lite e o STCP OFTP Client que está
sendo configurada, exigir autenticação, o **Certificado Digital** deverá ser informado na guia **SSL3** no campo **Arquivo** da opção **Certificados CA (Autoridades)**. 

![](/images/imagem2/img78.png) 

----------------
## **STCPCLT - Notificação por Email**

### 1. Objetivo

Este documento tem como finalidade, demonstrar os procedimentos necessários para a configuração
e execução do script VBS, que pode ser utilizado para enviar, por e-mail, notificações de transferências
de arquivos e/ou erros, através do STCP OFTP Client.
Por se tratar de um script que utiliza uma linguagem universal (Visual Basic Scripting) e distribuída
gratuitamente pela Microsoft, podemos customizá-lo para atender as mais diversas necessidades da
área de monitoração, assim como filtrar as notificações e erros desejados.

### 2. Download do SCRIPT VBS
O envio das notificações por email é realizado através do script stcp-notifica.vbs, disponível para
download no link abaixo. Após o download, o conteúdo do arquivo zipado deverá ser copiado para a
pasta Program do diretório de instalação do STCP OFTP Client (Ex. C:\STCPCLT\Program).
LINK: (http://www.riversoft.com.br/produtos/pub/stcp-notifica.zip)

### 3. Configuração do SCRIPT VBS
Os parâmetros básicos a serem configurados nesse arquivo são:

```ini 
1. '* -------------------------------------------------------------------------------
2. '* Configuracao diretorios e perfil
3. '*
4. '* appDir => Diretorio de instalacao da aplicacao
5. '* appPerfil => Nome do perfil utilizado
6. '*
7. '* -------------------------------------------------------------------------------
8. appDir = "C:\STCPCLT\"
9. appPerfil = "NOME-PERFIL" 
```

Esses parâmetros definem os diretórios de instalação da aplicação e nome do perfil utilizado. 

PARÂMETROS | DESCRIÇÃO
:---       | :---
appDir     | Diretório de instalação da aplicação.
appPerfil  | Nome do perfil utilizado.

```ini 
1. '* -------------------------------------------------------------------------------
2. '* Configuracao do e-mail
3. '*
4. '* varFrom => Endereco e-mail do remetente
5. '* varTo => Endereco e-mail do destinatario
6. '* varCC => Endereco e-mail dos destinatarios (com copia)
7. '* varSubject => Assunto do e-mail
8. '*
9. '* -------------------------------------------------------------------------------
10. varFrom = "email@empresa.com.br"
11. varTo = "email@empresa.com.br"
12. varCC = ""
13. varSubject = "STCP - Log de transferencia de arquivos" 
``` 

Esses parâmetros definem o destinatário, remetentes e assunto do e-mail que será enviado.

PARÂMETROS | DESCRIÇÃO
:---       | :---
varFrom    | Endereço de e-mail do remetente.
varTo      | Endereço de e-mail do destinatário. Para múltiplos destinatários, separe os endereços de e-mail por ponto e vírgula.
varCC      | Endereço de e-mail do destinatário (com cópia). Para múltiplos destinatários, separe os endereços de e-mail por ponto e vírgula.
varSubject | Assunto do e-mail.

```ini 
1. '* -------------------------------------------------------------------------------
2. '* Configura servidor SMTP
3. '*
4. '* Caso o SMTP utilize autenticacao devera ser informado:
5. '* varUserID => Usuario
6. '* varPasswd => Senha
7. '* varUseSSL => true | false
8. '* varAuth => Tipo Autenticacao
9. '* NONE
10. '* Basic (Base64 encoded) = 1
11. '* NTLM = 2
12. '*
13. '* -------------------------------------------------------------------------------

14. varSMTP = "smtp.empresa.com.br"
15. varPort = "465"
16. varUseSSL = true
17.
18. varUserID = "email@empresa.com.br"
19. varPasswd = "senha-smtp"
20. varAuth = 1 
```

Esses parâmetros fornecem as informações de configuração para o servidor SMTP remoto.

PARÂMETROS | DESCRIÇÃO
:---       | :---
varSMTP    | Endereço do servidor SMTP.
varPort    | Porta do servidor SMTP (Utilizada geralmente a porta 465).
varUseSSL  | Uso da Encriptação SSL/TLS. As opções disponíveis são: HABILITADO TRUE DESABILITADO FALSE
varUserID  | Usuário utilizado para autenticação.
varPasswd  | Senha do usuário utilizado para autenticação.
varAuth    | Tipo de autenticação do servidor SMTP. As opções disponíveis são: /NONE > NONE /BASIC (base64) > 1 /NTLM > 2

### 4. Teste do envio de e-mail

Para realizar a validação das configurações realizadas no item anterior (3. CONFIGURAÇÃO DO SCRIPT VBS), acesse o _Prompt de Comando_ e digite o comando abaixo.

1. cscript C:\STCPCLT\Program\stcp-notifica.vbs TESTE 

![](/images/imagem2/img79.png) 

Caso nenhuma mensagem de erro seja apresentada, verifique se um e-mail de teste foi recebido nos
endereços de e-mails configurados. 

### 5. Notificação envio e recebimento de arquivos (CONSOLIDADO)

Neste tipo de notificação, os logs de envio e recebimento de arquivos são enviados no corpo do email
de maneira consolidada, registrando os eventos de inicio e fim de conexão com sucesso ou erro,
início e fim de transmissão com sucesso ou erro e início e fim de recepção com sucesso ou erro.

![](/images/imagem2/img80.png) 

Após as configurações e testes do script serem realizados, acesse o _STCP OFTP Client Config_, na guia _Perfis_, selecione o perfil desejado e clique no botão _Propriedades_.  
Na janela _Propriedades do Perfil_, guia _Avançadas I_, preencha o campo _Executar_ comando no fim da conexão, conforme exemplo abaixo:

1. cscript //B C:\STCPCLT\Program\stcp-notifica.vbs TRANSF

![](/images/imagem2/img81.png) 

### 6. Notificação envio de arquivos (por arquivo)

Neste tipo de notificação, é enviado um e-mail para cada arquivo transmitido (TX) com sucesso.
Após as configurações e testes do script serem realizados, acesse o _STCP OFTP Client Config_, na guia _Perfis_, selecione o perfil desejado e clique no botão _Propriedades_.

Na janela _Propriedades do Perfil_, guia _Tipos de arquivos_, selecione o tipo de arquivo desejado e clique no botão _Propriedades_. Em _Características da transmissão_, preencha o campo _Executar comando externo_, conforme exemplo abaixo:

1. cscript //B C:\STCPCLT\Program\stcp-notifica.vbs TX $OFNAME 

![](/images/imagem2/img82.png) 

> NOTA: O parâmetro **$LFNAME** refere-se a uma variável interna do STCP OFTP que retorna o nome
do arquivo enviado com sucesso. 

### 7. Notificação recebimento de arquivos (por arquivo)

Neste tipo de notificação, é enviado um e-mail para cada arquivo recebido (RX) com sucesso.
Após as configurações e testes do script serem realizados, acesse o _STCP OFTP Client Config_, na guia _Perfis_, selecione o perfil desejado e clique no botão _Propriedades_.

Na janela Propriedades do _Perfil_, guia _Tipos de arquivos_, selecione o tipo de arquivo desejado e clique no botão _Propriedades_. Em _Características da recepção_, preencha o campo _Executar comando externo_, conforme exemplo abaixo:

1. cscript //B C:\STCPCLT\Program\stcp-notifica.vbs RX $OFNAME 

![](/images/imagem2/img83.png) 

> NOTA: O parâmetro **$OFNAME** refere-se a uma variável interna do STCP OFTP que retorna o nome do arquivo recebido com sucesso.

### 8. Notificação de Erro

Neste tipo de notificação, é enviado um e-mail para cada erro gerado no processo de transferência de arquivos.

Após as configurações e testes do script serem realizados, acesse o _STCP OFTP Client Config_, e na guia _Avançadas_ clique no botão _Log_. Na janela _Propriedades do Log_, em Nível de Log, configure o campo _Executar comando externo_ com o valor _1_ e o campo _Comando externo_ conforme exemplo abaixo:

1. cscript //B C:\STCPCLT\Program\stcp-notifica.vbs ERRO 

![](/images/imagem2/img84.png) 

-----------
## **Configuração da agenda de execução automática do Riversoft STCP OFTP Client no Windows e Windows Server.**

Para executar automaticamente a aplicação de transferência de arquivos, devemos realizar os seguintes passos de
configuração das tarefas agendadas do sistema operacional:

1. Acesse o **Agendador de Tarefas** dentro de **Ferramentas Administrativas**   
(Iniciar > Todos os aplicativos > Ferramentas Administrativas).

2. Clique em **Criar Tarefa** no painel **Ações**.

![](/images/imagem2/img85.png) 

3. Na guia Geral da janela de criação da tarefa configure os campos conforme a sua necessidade. Observe atentamente as opções de segurança conforme as configurações do seu ambiente. 

![](/images/imagem2/img86.png) 

4. Na guia **Disparadores** clique no botão **Novo**.

![](/images/imagem2/img87.png) 

5. Na janela **Novo Disparador** configure o agendamento conforme desejado e clique no botão **OK** para salvar as informações.

![](/images/imagem2/img88.png) 

6. Na guia **Ações** clique no botão **Novo**. 

![](/images/imagem2/img89.png) 

7. No campo **Programa/script** informe a linha de comando utilizada para executar o STCP OFTP Client (vide exemplo abaixo) e clique no botão **OK**.

**Exemplo:**  
C:\STCPCLT\program\stcpclt.exe "C:\STCPCLT\CTCP.INI" -p PERFIL-TESTE -r 5 -t 30 -m B

![](/images/imagem2/img90.png) 

**OBSERVAÇÃO**  
Para obter a linha de comando utilizada, clique com o botão direito do mouse no atalho do STCP OFTP Client, que foi criado na área de trabalho no momento da instalação e configuração do software. Na guia **Atalho**, copie o conteúdo do campo **Destino**. 

![](/images/imagem2/img91.png) 

8. Ao ser apresentada a mensagem abaixo clique no botão **Sim**. 

![](/images/imagem2/img92.png) 

9. Após a criação da tarefa, esta será exibida na janela principal do **Agendador de Tarefas**.

![](/images/imagem1/img93.png)

------------
## **Procedimento para a instalação do STCP OFTP Client (Windows) em ambiente Linux com Wine.**

Para realizar a instalação da aplicação Riversoft STCP OFTP Client em ambiente Linux, é utilizado o software “**WINE**” (**W**ine **I**s **N**ot an **E**mulator). O WINE é uma implementação de código aberto da API do Windows no topo da API do Linux, criando uma camada de compatibilidade que permite a execução de aplicações Microsoft Windows ™ no Linux.

A Riversoft não fornece suporte ao software Wine. Maiores detalhes e resolução de problemas, relacionados ao Wine, deverão ser obtidas através do site do produto.  
(http://www.winehq.org/)

![](/images/imagem2/img94.png) 

### 1. Instalação do WINE (Exemplos de uso)

1. Instalação através de um pacote RPM

* Faça download do arquivo RPM contendo o WINE.  
* Utilize o comando abaixo para realizar a instalação:  
 #rpm -ivh wine-x.x-x.rpm

2. Instalação através de um pacote TAR.GZ

* Faça download do arquivo contendo o código fonte do WINE;  
* Utilize o comando abaixo para descompactá-lo:  
 #tar xzvf wine-x.x-x.tar.gz

* Acesse o diretório recém-criado (Ex.: wine-x.x-x) e digite:
/images/configure  
make depends  
make  
make install  

Ou acesse a pasta ”Tools” e utilize os comandos abaixo:  
/images/wineinstall  
/images/winesetup  

3. Instalação através do APT-GET

* Utilize o comando abaixo para realizar a instalação:  
 #apt-get install wine1.4-i386

Após a sua instalação e configuração, o WINE cria a pasta "**.wine**" (oculta) dentro do seu diretório “**Home**”, nesta pasta ficam as configurações do Wine e os programas instalados.

Dentro dela também ficam duas pastas: “**dosdevices**” e “**drive_c**”. A pasta “**dosdevices**” contém links simbólicos para pastas do sistema, o que nos permite criar as unidades de disco e outros dispositivos que serão vistos pelos programas rodados pelo Wine.

A “**drive_c**” é a pasta onde o WINE simulará como sendo a unidade “**C:**”. Nesta o WINE reproduz a estrutura de pastas essenciais do Windows (como a própria pasta do Windows e System, dos perfis, a arquivos de programas, etc).

Dentro da pasta “**.wine**” existem também alguns arquivos de configuração: system.reg, userdef.reg e user.reg.

### 2. Instalação do STCP OFTP CLIENT

Descompacte o arquivo “**STCPClient-PTB-4_2_0.tar.gz**” no diretório desejado. Neste exemplo
utilizaremos a pasta "/home/riversoft“.

 #tar -zxvf /home/riversoft/STCPClient-PTB-4_2_0.tar.gz

![](/images/imagem2/img95.png) 

A pasta “**STCPCLT**” será criada dentro do diretório especificado, neste exemplo “**/home/riversoft/STCPCLT**”.

Verifique se a mesma possui os direitos de escrita, leitura e execução para o usuário em uso. Caso necessário faça as alterações das permissões no diretório e subdiretórios.

### 3. Configuração do WINE

Através do "Painel inicial" acesse a opção “**Configurar o Wine**”. Você também pode acessar esta aplicação através do terminal digitando _winecfg_ 

![](/images/imagem2/img96.png) 

Na janela de "Configuração do Wine", selecione a guia "Unidades" e clique no botão "Adicionar".

![](/images/imagem2/img97.png)

Selecione a unidade "D:" para criar um novo mapeamento no Wine e pressione o botão "OK".

_OBS: Os arquivos de configuração "CTCP.INI" e "O0055LOCAL.INI" utilizam esta unidade na
configuração de seus parâmetros._ 

![](/images/imagem2/img98.png) 

Com o mapeamento "D:" já criado, clique no botão "Procurar".

![](/images/imagem2/img99.png) 

Selecione o diretório (Ex. /home/riversoft) desejado e pressione o botão “**OK**”. 

![](/images/imagem2/img100.png)

A unidade “**D:**” será mapeada para a pasta “**/home/riversoft**”.  
Pressione o botão “**OK**” para finalizar o processo de configuração do Wine.

![](/images/imagem2/img101.png) 

![](/images/imagem2/img102.png) 

### 4. Executar o STCP OFTP CLIENT
Para realizar as configurações necessárias na aplicação será necessário executar o STCP OFTP Client Config. Utilize a linha de comando abaixo através do terminal:

**STCP OFTP Client Config (configurador da aplicação)**  

**wine** D:\ \STCPCLT\ \Program\ \StcpCfg.exe D:\ \STCPCLT\ \CTCP.INI

![](/images/imagem2/img103.png) 

Após realizar as configurações necessárias, para executar o STCP OFTP Client abra o terminal e
utilize a linha de comando abaixo:

**Console da aplicação Riversoft STCP OFTP Client**

**wine** D:\\STCPCLT\\Program\\stcpclt.exe D:\\STCPCLT\\CTCP.INI  
-p O0055LOCAL -r 5 -t 30 -m B

![](/images/imagem2/img104.png) 

### 5. Configuração da agenda de execução automática do STCP OFTP CLIENT

Para executar automaticamente a aplicação de transferência de arquivos, devemos realizar a configuração do serviço Unix “**cron**”.

Abra o terminal e digite:

```ini
#crontab -e
```
Edite os parâmetros de sua crontab conforme os dados abaixo:

```ini
# ========================
# Executa STCP OFTP Client
# ========================
0-59/5 * * * * export DISPLAY=:1 && wine D:\\STCPCLT\\Program\\stcpclt.exe
D:\\STCPCLT\\CTCP.INI -p O0055LOCAL -r 5 -t 30 -m B 
```

_OBS: No exemplo acima o STCP OFTP Client será executado no intervalo de 5/5 minutos, realizando o envio e/ou recebimento dos arquivos._ 

