---
date: 2017-01-16
title: Signer
categories:
  - Signer
description: STCPSigner Versão 4.0.0 
type: Document
---

# STCPSigner Versão 4.0.0

## **O que é o STCPSigner?** 

O STCPSigner é um módulo utilizado para garantir a integridade, autenticidade, confidencialidade e inviolabilidade de um arquivo através da tecnologia de assinatura digital e da criptografia.

![](/images/imagem2/imgSig220.png) 

O STCPSigner implementa a especificação RFC2315 (PKCS#7) e está em conformidade com a norma do Banco Central do Brasil (Carta Circular 3.134) sobre a utilização da assinatura digital em contratos de câmbio.

Um documento eletrônico assinado/criptografado com o STCPSigner poderá ser decriptografado/validado com a utilização de outros produtos que sigam a mesma especificação. 

### Arquitetura

O STCPSigner utiliza a interface Microsoft CRYPTOAPI para acesso aos dispositivos criptográficos(Token, Smartcard, etc) e de armazenamento dos certificados digitais.

![](/images/imagem2/imgSig221.png) 

### Características Gerais

* Assinatura digital com certificado digital X509  
* Criptografia com chaves RC2, DES, 3DES, AES (Somente Vista)   
* Compatível com CRYPTOAPI (Microsoft)   
* Compatível com a RFC2315/Carta Circular 3.123 do Banco Central do Brasil   
* Compatível com certificados ICP Brasil   
* Inclusão do certificado de assinatura no envelope PKCS#7   
* Inclusão da cadeia de certificados do assinante no envelope PKCS#7   
* Verificação da lista local ou remota de certificados revogados   
* Verificação do status do certificado online (OCSP) quando disponível   

### Fluxo de Assinatura

No processo de assinatura, o remetente assina digitalmente o arquivo de entrada e o STCPSigner grava o arquivo de saída contendo as informações do certificado utilizado, a assinatura e os dados do arquivo de entrada.

O arquivo de saída é também chamado de PKCS#7. 

![](/images/imagem2/imgSig222.png) 

O STCPSigner deve ser executado com os seguintes parâmetros para realizar o processo de assinatura de um arquivo:

“**stcpsigner sign –i < certificado-remetente> -n < arquivo de entrada> -o <arquivo de saída>**”

### Fluxo da Validação

O STCPSigner utiliza o certificado informado pelo remetente para validar a assinatura, o certificado e os dados contidos no arquivo de entrada para gravar o arquivo de saída somente com os dados. 

![](/images/imagem2/imgSig223.png)

O STCPSigner deve ser executado com os seguintes parâmetros para realizar o processo de validação da assinatura de um arquivo:

“**stcpsigner verify –i < certificado-remetente> -n < arquivo de entrada> -o <arquivo de saída>**”

### Fluxo de Criptografia

No processo de criptografia, o remetente cifra os dados associando-os à Chave Pública e ao certificado da entidade de destino.

![](/images/imagem2/imgSig224.png) 

O STCPSigner deve ser executado com os seguintes parâmetros para realizar o processo de criptografia de um arquivo:

“**stcpsigner crypt –i < certificado-destinatário> -n < arquivo de entrada> -o <arquivo de saída>**”

### Fluxo de Decriptografia

Os dados recebidos do remetente são decriptografados com a Chave Privativa correspondente do destinatário.

![](/images/imagem2/imgSig225.png) 

O STCPSigner deve ser executado com os seguintes parâmetros para realizar o processo de decriptografia de um arquivo:

“**stcpsigner decrypt –i < certificado-destinatário> -n < arquivo de entrada> -o <arquivo de saída>**”

### Requisitos de software e hardware

* Microcomputador Pentium superior  
* Memória de 64 Mbytes ou superior  
* Espaço no disco rígido de 5 Mbytes  
* Sistema operacional Windows 2000/2003/XP/VISTA  
* Interface de criptografia Microsoft CRYPTOAPI  

--------
## **Como instalar o STCPSigner** 

1. Insira o CD na unidade de leitura.

2. Em **Iniciar**, escolha a opção **Executar**.

3. Utilize o botão **Procurar** para acessar a unidade de leitura de CD.

4. Selecione o programa **SETUP.EXE**.

5. Execute o programa.

-----------
## **Como utilizar o STCPSigner** 

### Como gerar um par de chaves

Para criar o par de chaves pública/privativa padrão RSA com 1024 bits de acesso exclusivo pelo administrador ou o system account:   
O < nome do armazenamento> é de livre escolha.

Stcpsigner genkey -b Teste.Key -d 1024 -j system

### Como gerar um certificado auto-assinado

Para criar um certificado auto-assinado para o par de chaves pública/privativa:    
Stcpsigner gencertself -b Teste.Key -j system -h "CN=STCPSigner.Teste, O=EMPRESA, OU=EDI, C=BR,L=Sao Paulo"

### Como exportar o certificado

Para exportar o certificado do par de chaves pública/privativa para um arquivo do tipo PEM:   
Stcpsigner expcert -j system -i "STCPSigner.Teste" -o stcpsigner.cer -q pem

### Como assinar um arquivo

Para assinar um arquivo:  
Stcpsigner sign -j system -i "STCPSigner.Teste" -n < arquivo de entrada> -o <arquivo de saída>

### Como verificar um arquivo assinado

Para verificar um arquivo assinado:   
Stcpsigner verify -j system -i "STCPSigner.Teste" -n < arquivo de entrada> -o <arquivo de saída>

### Como encriptar um arquivo

Para encriptar um arquivo:   
Stcpsigner crypt -j system -i "STCPSigner.Teste" -n < arquivo de entrada> -o <arquivo de saída>

### Como decriptar um arquivo

Para decriptar um arquivo:   
Stcpsigner decrypt -j system -i "STCPSigner.Teste" -n < arquivo de entrada> -o <arquivo de saída>

### Como remover a chave privativa

Para remover a chave privativa:  
O < nome do armazenamento> é de livre escolha.   
Stcpsigner delkey -b "Teste.Key" -j system

### Como remover o certificado

Para remover o certificado:   
Stcpsigner delcert -i "STCPSigner.Teste" -j system

---------
## **Como executar o STCPSigner** 

### Linha de comando

stcpsigner.exe cmd [opções]

Comando (cmd)|  Descrição
:---         | :---
crypt        | Criptografa os dados.
decrypt      | Decriptografa os dados.
sign         | Assina digitalmente.
verify       | Verifica a assinatura digital.
sign-crypt   | Assina digitalmente e criptografa.
decrypt-verify| Decriptografa os dados e verifica assinatura.
genkey       | Gera o par de chaves pública/privativa.
delkey       | Remove o par de chaves pública/privativa.
expkey       | Exporta o par de chaves pública/privativa.
impkey       | Importa o par de chaves pública/privativa.
gencertself  | Gera certificado auto-assinado.
gencertreq   | Gera requisição de certificado (CSR – PKCS#10).
delcert      | Remove certificado.
impcert      | Importa certificado de um arquivo.
expcert      | Exporta o certificado para um arquivo.
delcertstore | Deleta armazenamento de certificados.
listprov     | Mostra os provedores de criptografia.
listcont     | Mostra os armazenamentos de chave de criptografia.
listcerts    | Mostra os certificados.
listcrls     | Mostra a lista de certificados revogados.
pkcs7convert | Converte o formato do arquivo entre DER e BASE64.
addoidinfo   | Adiciona informação para código OID.
deloidinfo   | Remove informação para código OID.
listoidinfo  | Mostra os códigos OID cadastrados.

### Controle das chaves

[Opções]| Descrição
:---    | :---
-a      | Nome do provedor de criptografia.
-b      | Nome do container.
-c      | Tipo do provedor (full, aes, dss ou fortezza). /Default: full
-d      | Tamanho da chave (512,1024,2048 ou 4096). /Default: 512
-e      | Senha da chave privativa ou PIN para token/smartcard.
-f      | Algoritmo de criptografa da chave privativa (des, 3des, rc2, rc4, aes ou aes256). /Default: 3des

### Controle do certificado

[Opções] | Descrição
:---     | :---
-g       | Nome do store dos certificados.
-h       | RDN para geração da requisição do certificado.
-i       | Assunto do certificado.
-I       | Assunto do certificado de criptografia.
-j       | Localização do certificado (user, system, ou services). /Default: user

### Controle da criptografia

[Opções] | Descrição
:---     | :---
-k       | Algoritmo de criptografia do arquivo (none, 3des, rc4, rc2cbc, aes128, aes256). /Default: 3des
-l       | Tipo do conteúdo do arquivo (plain, data, enveloped ou signed). /Default: plain
-r       | Algoritmo de hash (md5 ou sha1). /Default: sha1

### Outros

[Opções] | Descrição
:---     | :---
-m       | Tamanho do buffer.
-n       | Nome do arquivo de entrada. /Default: stdin
-o       | Nome do arquivo de saída. /Default: stdout
-p       | Tipo do arquivo de entrada (pem ou der). /Default: der
-q       | Tipo do arquivo de saída (pem ou der). /Default: der
-s       | Habilita proteção da chave privativa.
-t       | Habilita exportação da chave privativa.
-u       | Habilita verificação da cadeia de certificados (chain).
-U       | Opções para verificação de revogação dos certificados.
CheckChain| Verifica CRL para toda a cadeia.
CheckChainCacheOnly| Verifica CRL para toda a cadeia (somente cache).
CheckEndCert| Verifica CRL para o último certificado.
CheckEndCertCacheOnly| Verifica CRL para o último certificado (somente cache).
CheckChainExcludeRoot| Verifica CRL para a cadeia sem o certificado Root.
CheckChainExcludeRootCacheOnly| Verifica CRL para a cadeia sem o certificado Root (somente cache).
-v        | Descrição do arquivo que será informada no atributo '1.3.6.1.4.1.311.88.2.2' do PKCS#7.
-x        | Nome do diretório temporário.
-y        | Nome do arquivo que será informado no atributo '1.3.6.1.4.1.311.88.2.1' do PKCS#7.
-z        | Inibe verificação da assinatura do executável.
-X        | Inibe verificação do certificado de assinatura no armazenamento local.
-T        | Habilita validação do certificado pela data e hora contida no envelope PKCS#7.
-O        | Habilita sobreposição do arquivo.
-?        | Ajuda.
